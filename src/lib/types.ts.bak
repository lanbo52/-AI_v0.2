export type FileType = 'folder' | 'markdown' | 'json' | 'image' | 'video';

export interface VirtualFile {
  id: string;
  projectId: string;
  path: string; // e.g., "episodes/EP-01.md"
  name: string;
  type: FileType;
  content: string; // For text files, this is the text. For binary, it's a blob url or base64? Let's use string for now.
  createdAt: number;
  updatedAt: number;
}

export interface Project {
  id: string;
  name: string;
  description?: string;
  previewImage?: string;
  createdAt: number;
  updatedAt: number;
}

// --- Agent System

// Agent Types
export type AgentRole = 'writer' | 'aligner' | 'director' | 'visualizer' | 'motion' | 'recorder' | 'auto_fixer';

export type AgentStatus = 'idle' | 'working' | 'success' | 'failed';

export interface AgentMessage {
  role: 'user' | 'assistant' | 'system';
  content: string;
  timestamp: number;
  action?: {
    type: 'auto_fix';
    targetFile: string;
    originalContent: string;
    feedback: string;
  };
}

export interface AgentState {
  status: AgentStatus;
  currentTask?: string;
  phase?: string; // High-level operation phase (e.g. '正在质检', '自动修复中')
  progress?: number;
  logs: string[];
  // For Interactive Writer
  chatHistory?: AgentMessage[];
  // Action for UI (e.g. Auto Fix button in status card)
  action?: AgentMessage['action'];
}

export interface ChatSession {
  id: string;
  projectId: string;
  title: string; // [NEW] For AI summary
  agentRole: AgentRole;
  messages: AgentMessage[];
  createdAt: number;
  updatedAt: number;
}

// --- Storyboard Types ---
export interface Shot {
  id: string;
  shotType: string;
  angle: string;
  movement: string;
  visual: string;
  audio: string;
  duration: number;
  // Visualizer Output
  visualPrompt?: string; // For single frame or backward compatibility
  visualPromptStart?: string; // For keyframes
  visualPromptEnd?: string; // For keyframes
  isKeyframe?: boolean;
  keyframeReason?: string;
  imageUrl?: string;
  // Motion Output
  motionPrompt?: string;
  motionParameters?: string;
}

export interface Scene {
  id: string;
  location: string;
  summary: string;
  shots: Shot[];
}

// --- Episode Progress Types ---
export type EpisodeStatus = 'not_started' | 'in_progress' | 'script_completed' | 'storyboard_completed';

// 自动跳转偏好设置类型
export type AutoAdvancePreference = 'immediate' | 'confirm' | 'disabled';

export interface EpisodeProgress {
  id: string; // episode path like "episodes/EP-01.md"
  name: string; // display name like "EP-01"
  episodeNumber: number;
  status: EpisodeStatus;
  scriptWordCount: number;
  hasStoryboard: boolean;
  createdAt: number;
  updatedAt: number;
  // 新增字段
  title?: string;         // 从Markdown内容解析出的标题 (e.g. "初遇")
  sceneCount?: number;    // 场景数量
  qualityCheckPassed?: boolean; // 质检是否通过 (根据最后一次修改和质检记录，目前简化处理)
}
